[mysqld]
# Event scheduler (required for temp user auto-cleanup)
event_scheduler          = ON

# --- GTID Replication ---
gtid_mode                = ON
enforce_gtid_consistency = ON
log_bin                  = /var/lib/mysql/binlog
binlog_format            = ROW
binlog_row_image         = FULL
log_slave_updates        = ON
relay_log                = /var/lib/mysql/relay-bin
relay_log_recovery       = ON

# Server ID is set at runtime via cloud-init (unique per node).
# server-id = <set by cloud-init>

# Crash-safe replication
sync_binlog              = 1
innodb_flush_log_at_trx_commit = 1

# Binary log expiration (7 days)
binlog_expire_logs_seconds = 604800

# Parallel replication
replica_parallel_workers  = 4
replica_parallel_type     = LOGICAL_CLOCK
replica_preserve_commit_order = ON

# Performance
binlog_transaction_dependency_tracking = WRITESET
transaction_write_set_extraction       = XXHASH64
